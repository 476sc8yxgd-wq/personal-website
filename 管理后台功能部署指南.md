# 🎉 管理后台功能部署指南

## ✅ 已实现的功能

### 1. 分类下拉选择 ✅
- 创建博客时，从下拉列表选择分类，无需手动输入ID
- 编辑博客时，也可以从下拉列表选择分类

### 2. 博客编辑功能 ✅
- 在博客列表中点击"编辑"按钮
- 弹出编辑模态框
- 可以修改标题、内容、分类和封面图片

### 3. 博客删除功能 ✅
- 在博客列表中点击"删除"按钮
- 确认删除后，博客将被永久删除

### 4. 图片上传功能 ✅
- 创建博客时可以上传封面图片
- 编辑博客时可以更新封面图片
- 图片上传到 Supabase Storage
- 支持图片预览

---

## 🚀 部署步骤

### 步骤 1：创建 Supabase Storage 存储桶（必需！）

图片上传功能需要使用 Supabase Storage，必须先创建存储桶：

#### 1.1 登录 Supabase 控制台
- 访问：https://supabase.com/dashboard
- 进入您的项目：`assfhuxuglbootvpigeu`

#### 1.2 创建存储桶
1. 在左侧菜单找到 **"Storage"**
2. 点击进入
3. 点击 **"New bucket"** 或 **"Create a new bucket"**
4. 填写信息：
   - **Name**: `blog-images`
   - **Public bucket**: ✅ 勾选（允许公开访问）
5. 点击 **"Create bucket"**

#### 1.3 设置存储桶权限
1. 点击刚创建的 `blog-images` 存储桶
2. 点击 **"Policies"** 标签
3. 点击 **"New Policy"** 按钮
4. 选择 **"Get started quickly"**
5. 创建以下策略：

**对于公开访问（阅读）：**
- **Policy name**: `Public Access`
- **Allowed operations**: 勾选 **SELECT**
- **Target role**: `anon`
- 点击 **"Use this template"**
- 点击 **"Save"**

**对于上传（写入）：**
- **Policy name**: `Upload Access`
- **Allowed operations**: 勾选 **INSERT**
- **Target role**: `authenticated`
- 点击 **"Use this template"**
- 点击 **"Save"**

#### 1.4 验证存储桶
在 Storage 页面，您应该看到：
- `blog-images` 存储桶
- 公开访问已启用
- 两个策略已创建（SELECT 和 INSERT）

---

### 步骤 2：检查数据库表结构

确保 `blogs` 表有 `cover_image` 字段：

1. 在 Supabase 控制台
2. 进入 **"Table Editor"**
3. 选择 `blogs` 表
4. 检查是否有 `cover_image` 字段（类型：text）

**如果没有，执行以下 SQL：**

在 **SQL Editor** 中执行：

```sql
ALTER TABLE blogs ADD COLUMN IF NOT EXISTS cover_image TEXT;
```

---

### 步骤 3：构建前端

在项目根目录打开 PowerShell，执行：

```powershell
cd "c:/Users/28945/Desktop/个人网站重制版/frontend"
npm run build
```

**预期输出：**
```
✓ 99 modules transformed.
dist/index.html ...
✓ built in 5.92s
```

---

### 步骤 4：上传到服务器

#### 方式 A：使用宝塔面板（推荐）

1. **登录宝塔面板**
   - 地址：https://43.138.3.207:20794/8ff1df99

2. **进入文件管理**
   - 左侧菜单 → 文件
   - 导航到：`/var/www/personal-website/public`

3. **上传文件**
   - 点击"上传"
   - 选择：`C:\Users\28945\Desktop\个人网站重制版\frontend\dist` 下的所有文件
   - 等待上传完成

#### 方式 B：使用 WinSCP

1. 连接到服务器
2. 上传 `frontend/dist` 目录下的所有文件
3. 到 `/var/www/personal-website/public`

---

### 步骤 5：重启服务

在宝塔面板的终端中执行：

```bash
cd /var/www/personal-website
docker-compose restart
```

---

## 📋 使用新功能

### 1. 创建分类

1. 访问管理后台：http://43.138.3.207:8008/admin
2. 找到"创建新分类"表单
3. 填写：
   - 分类名称：如"技术博客"
   - 分类描述：（可选）
4. 点击"创建分类"

**注意：** 创建分类后，会自动刷新分类列表。

---

### 2. 创建博客（带封面图片）

1. 在管理后台，找到"创建新博客"表单
2. 填写：
   - **标题**: 博客标题
   - **分类**: 从下拉列表选择
   - **封面图片**: 点击文件选择，选择图片
   - **内容**: 博客内容
3. 点击"创建博客"

**图片要求：**
- 支持的格式：jpg, png, gif, webp
- 建议尺寸：1200x630 像素
- 建议大小：小于 2MB

**上传过程：**
- 选择图片后自动上传
- 上传成功后会显示预览
- 可以预览后决定是否创建

---

### 3. 编辑博客

1. 在博客列表中找到要编辑的博客
2. 点击该博客的"编辑"按钮
3. 弹出编辑模态框
4. 修改：
   - 标题
   - 分类（下拉选择）
   - 封面图片（可以重新上传）
   - 内容
5. 点击"更新博客"

**注意：**
- 封面图片是可选的，可以保持原样或重新上传
- 如果不重新上传，会保留原有图片

---

### 4. 删除博客

1. 在博客列表中找到要删除的博客
2. 点击该博客的"删除"按钮
3. 确认删除提示
4. 博客被永久删除

**警告：**
- 删除操作不可恢复
- 确认提示会显示博客标题
- 请仔细确认后再点击确定

---

### 5. 回答问题

1. 在管理后台，切换到"问答管理"标签
2. 查看待回答的问题列表
3. 在问题下方输入回答
4. 点击"提交回答"

**注意：**
- 只显示状态为"pending"（待回答）的问题
- 回答后问题状态变为"answered"（已回答）
- 可以在问答页面查看回答结果

---

## 🎯 功能测试清单

### 测试创建博客

- [ ] 可以从下拉列表选择分类
- [ ] 可以上传封面图片
- [ ] 图片上传成功并显示预览
- [ ] 博客创建成功
- [ ] 博客列表显示新博客

### 测试编辑博客

- [ ] 点击"编辑"按钮弹出模态框
- [ ] 可以修改标题
- [ ] 可以从下拉列表选择分类
- [ ] 可以重新上传封面图片
- [ ] 更新成功
- [ ] 修改内容已保存

### 测试删除博客

- [ ] 点击"删除"按钮显示确认提示
- [ ] 确认提示显示博客标题
- [ ] 删除成功
- [ ] 博客列表中已删除

### 测试图片上传

- [ ] 支持选择图片文件
- [ ] 上传过程显示"上传中..."
- [ ] 上传成功后显示预览
- [ ] 图片正确显示在博客列表

---

## 🔧 常见问题

### Q1: 图片上传失败

**可能原因：**
- Supabase Storage 存储桶未创建
- 存储桶权限未正确设置
- 网络问题

**解决方法：**
1. 检查 Supabase Storage 是否创建了 `blog-images` 存储桶
2. 检查存储桶是否有公开访问权限（SELECT）和上传权限（INSERT）
3. 查看浏览器控制台的错误信息

### Q2: 创建博客时看不到分类下拉列表

**可能原因：**
- 分类列表未加载
- 没有创建分类

**解决方法：**
1. 先创建至少一个分类
2. 刷新页面
3. 检查浏览器控制台是否有错误

### Q3: 编辑博客时无法保存

**可能原因：**
- 表单验证失败
- 网络问题

**解决方法：**
1. 确保标题和内容不为空
2. 检查是否选择了分类
3. 查看浏览器控制台的错误信息

### Q4: 删除博客后，博客列表未更新

**可能原因：**
- 缓存问题
- 前端未刷新

**解决方法：**
1. 刷新浏览器页面
2. 清除浏览器缓存
3. 检查数据库确认博客是否已删除

---

## 📊 界面截图说明

### 博客列表表格

| 列名 | 说明 |
|------|------|
| 封面 | 博客封面图片缩略图（如有） |
| 标题 | 博客标题 |
| 分类 | 博客所属分类名称 |
| 浏览量 | 博客浏览次数 |
| 状态 | 博客状态（published/draft） |
| 创建时间 | 博客创建日期 |
| 操作 | "编辑"和"删除"按钮 |

### 编辑模态框

- 标题输入框
- 分类下拉选择
- 封面图片上传（带预览）
- 内容文本框（8行）
- "更新博客"和"取消"按钮

---

## 🚨 重要提示

### 关于图片存储

1. **存储桶必须公开**
   - 图片需要公开访问才能显示
   - 如果存储桶是私有的，图片无法显示

2. **存储桶名称必须一致**
   - 代码中使用的是 `blog-images`
   - 必须使用这个确切的名称

3. **权限策略必须正确**
   - `anon` 角色：SELECT（读取）
   - `authenticated` 角色：INSERT（写入）

### 关于博客管理

1. **先创建分类**
   - 创建博客前需要先有分类
   - 可以创建多个分类

2. **封面图片是可选的**
   - 可以不上传封面图片
   - 博客列表显示"无图片"占位符

3. **删除不可恢复**
   - 删除操作会永久删除博客
   - 请仔细确认后再操作

---

## ✅ 部署完成检查清单

部署完成后，请确认：

- [ ] Supabase Storage 已创建 `blog-images` 存储桶
- [ ] 存储桶权限已正确设置
- [ ] `blogs` 表有 `cover_image` 字段
- [ ] 前端文件已上传到服务器
- [ ] Docker 服务已重启
- [ ] 可以访问管理后台
- [ ] 可以创建分类
- [ ] 创建博客时可以看到分类下拉列表
- [ ] 可以上传封面图片
- [ ] 可以编辑博客
- [ ] 可以删除博客
- [ ] 可以回答问题

---

## 🎉 部署成功！

恭喜！您现在已经拥有功能完整的管理后台：

- ✅ 分类下拉选择
- ✅ 博客编辑功能
- ✅ 博客删除功能
- ✅ 图片上传功能

享受使用吧！ 🚀

---

**预计完成时间**: 15-20 分钟
**最后更新**: 2025-12-25
