# 宝塔面板部署个人网站方案

## 方案概述
使用宝塔面板（Baota Panel）来部署前端项目，后端继续使用Docker部署。

## 前提条件
- 服务器：43.138.3.207
- 宝塔面板已安装
- 服务器登录信息：
  - IP: 43.138.3.207
  - 用户名: root
  - 密码: Tencent@12345

## 方案一：使用宝塔面板+静态网站托管（推荐）

### 步骤1：登录宝塔面板
1. 在浏览器访问：`http://43.138.3.207:8888`
2. 输入宝塔面板用户名和密码
3. 进入控制面板

### 步骤2：准备前端项目
在本地构建前端项目：

```powershell
cd C:\Users\28945\Desktop\个人网站重制版\frontend
npm install
npm run build
```

构建完成后，会生成`dist`目录，包含所有静态文件。

### 步骤3：在宝塔面板中创建站点

1. 点击左侧菜单"网站"
2. 点击"添加站点"
3. 填写信息：
   - **域名**：43.138.3.207（或你的域名）
   - **根目录**：/www/wwwroot/personal-website
   - **FTP**：不创建
   - **数据库**：不创建
   - **PHP版本**：纯静态

4. 点击"提交"

### 步骤4：上传前端文件

#### 方法A：使用宝塔面板文件管理器（推荐）

1. 在宝塔面板左侧点击"文件"
2. 进入 `/www/wwwroot/personal-website` 目录
3. 删除默认的 index.html 和 404.html
4. 点击"上传"
5. 将本地的 `dist` 目录下的所有文件上传上去

#### 方法B：使用FTP上传

1. 在宝塔面板中创建FTP账号
2. 使用FileZilla或WinSCP连接
3. 上传 `dist` 目录下的所有文件到网站根目录

### 步骤5：配置反向代理（将前端请求转发到后端API）

1. 在宝塔面板中，点击"网站"→找到你的站点→点击"设置"
2. 点击左侧"反向代理"
3. 点击"添加反向代理"
4. 配置：
   - **代理名称**：api_proxy
   - **目标URL**：`http://127.0.0.1:3001`
   - **发送域名**：$host
   - **代理目录**：/api

5. 点击"提交"

### 步骤6：配置伪静态（支持React Router）

1. 点击"网站"→找到你的站点→点击"设置"
2. 点击左侧"伪静态"
3. 输入以下规则：

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

4. 点击"保存"

### 步骤7：配置跨域（如果需要）

1. 点击"网站"→找到你的站点→点击"设置"
2. 点击左侧"配置文件"
3. 在 `server` 块中添加：

```nginx
add_header 'Access-Control-Allow-Origin' '*';
add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization';
```

4. 点击"保存"
5. 重启Nginx

---

## 方案二：使用宝塔面板+Node.js环境

### 步骤1：安装Node.js环境

1. 在宝塔面板左侧点击"软件商店"
2. 搜索"Node.js版本管理器"或"PM2管理器"
3. 安装Node.js管理器
4. 安装Node.js（建议18.x或20.x版本）

### 步骤2：上传项目文件

1. 在宝塔面板左侧点击"文件"
2. 进入 `/www/wwwroot/` 目录
3. 创建新目录 `personal-website`
4. 上传整个项目文件（包括frontend和backend目录）

### 步骤3：后端部署（使用PM2）

1. 在宝塔面板左侧点击"软件商店"
2. 安装"PM2管理器"
3. 点击"PM2管理器"
4. 点击"添加项目"
5. 配置：
   - **项目名称**：personal-website-backend
   - **启动文件**：backend/dist/server.js
   - **项目目录**：/www/wwwroot/personal-website/backend
   - **启动命令**：node dist/server.js
6. 点击"提交"

### 步骤4：前端部署（使用Vite）

#### 选项A：开发模式部署

1. 在宝塔面板PM2管理器中添加项目
2. 配置：
   - **项目名称**：personal-website-frontend
   - **启动文件**：frontend/node_modules/vite/bin/vite.js
   - **项目目录**：/www/wwwroot/personal-website/frontend
   - **启动命令**：npm run dev -- --host 0.0.0.0 --port 3000
3. 点击"提交"

#### 选项B：生产模式部署（推荐）

1. 在宝塔面板文件管理器中，进入 `/www/wwwroot/personal-website/frontend`
2. 打开"终端"
3. 执行：
```bash
cd /www/wwwroot/personal-website/frontend
npm install
npm run build
```

4. 构建完成后，`dist`目录就是生产文件
5. 创建Nginx站点，指向 `/www/wwwroot/personal-website/frontend/dist`
6. 配置反向代理到后端API（参考方案一的步骤5）

---

## 方案三：混合部署（宝塔+Nginx+Docker）

### 架构说明
- **前端**：使用宝塔面板+Nginx托管静态文件
- **后端**：继续使用现有的Docker容器

### 步骤1：保持现有后端Docker部署

后端已经通过Docker部署并运行，无需修改。

### 步骤2：使用宝塔面板部署前端

按照"方案一"的步骤1-6执行，部署前端静态文件。

### 步骤3：配置反向代理到Docker后端

1. 在宝塔面板中，点击"网站"→找到你的站点→点击"设置"
2. 点击左侧"反向代理"
3. 添加反向代理：
   - **代理名称**：backend_api
   - **目标URL**：`http://127.0.0.1:3001`
   - **代理目录**：/api

4. 点击"提交"

---

## 常见问题解决

### 1. 后端API请求失败（404错误）

**原因**：前端请求的API路径没有正确转发到后端。

**解决**：
- 检查反向代理配置，确保 `/api` 路径正确转发到 `http://127.0.0.1:3001`
- 检查后端容器是否正常运行：`docker ps`

### 2. 刷新页面404

**原因**：React Router使用前端路由，Nginx需要配置支持。

**解决**：
- 按照方案一步骤6配置伪静态规则

### 3. 跨域错误（CORS）

**原因**：浏览器阻止跨域请求。

**解决**：
- 按照方案一步骤7配置CORS头
- 或者在后端代码中配置CORS

### 4. 静态资源加载失败

**原因**：路径配置错误。

**解决**：
- 确保 Vite 配置中 `base` 设置正确（如果部署在子目录）
- 检查 Nginx 配置的 root 路径是否正确

---

## 推荐方案

**最佳实践**：使用**方案三（混合部署）**

理由：
1. **前端**：使用宝塔面板+Nginx托管，性能好、易于管理、支持HTTPS
2. **后端**：继续使用Docker，部署简单、环境隔离
3. **灵活性**：前后端独立部署，互不影响
4. **维护性**：宝塔面板提供图形化管理界面，便于日常维护

---

## 快速开始（推荐操作流程）

### 第一步：准备前端

```powershell
cd C:\Users\28945\Desktop\个人网站重制版\frontend
npm install
npm run build
```

### 第二步：在宝塔面板中创建站点

1. 登录宝塔面板
2. 添加站点：`43.138.3.207` → `/www/wwwroot/personal-website`
3. 上传 `dist` 目录下的所有文件

### 第三步：配置反向代理

1. 在站点设置中添加反向代理
2. 将 `/api` 代理到 `http://127.0.0.1:3001`

### 第四步：验证

访问 `http://43.138.3.207`，查看网站是否正常运行。

---

## 需要帮助？

如果在部署过程中遇到问题，请：
1. 检查宝塔面板日志：左侧菜单"日志"
2. 检查Nginx错误日志：`/www/wwwroot/站点目录/logs/`
3. 检查后端Docker日志：`docker logs personal_website_backend`
