# 400é”™è¯¯æ·±åº¦åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

### æ¶æ„åˆ†æ

å½“å‰é¡¹ç›®æ¶æ„ï¼š
```
å‰ç«¯ (Vite + React)
  â†“
Supabase Client SDK (ç›´æ¥è¿æ¥)
  â†“
Supabase Cloud
```

**é—®é¢˜**ï¼šå‰ç«¯ç›´æ¥ä½¿ç”¨Supabase SDKï¼Œç»•è¿‡äº†åç«¯API

### 400é”™è¯¯çš„å¯èƒ½åŸå› 

#### 1. **Viteç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜** âš ï¸ æœ€å¯èƒ½
- `.env` æ–‡ä»¶æ ¼å¼é—®é¢˜
- ç¯å¢ƒå˜é‡æœªæ­£ç¡®åŠ è½½åˆ° `import.meta.env`
- Viteå¼€å‘ç¯å¢ƒé…ç½®é—®é¢˜

#### 2. **Supabaseå®¢æˆ·ç«¯é…ç½®é—®é¢˜**
- URLæ ¼å¼ä¸æ­£ç¡®
- API Keyæ ¼å¼ä¸æ­£ç¡®æˆ–å·²è¿‡æœŸ
- å®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°é—®é¢˜

#### 3. **ç½‘ç»œè¯·æ±‚é—®é¢˜**
- CORSè·¨åŸŸé—®é¢˜
- ç½‘ç»œè¿æ¥é—®é¢˜
- è¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆª

#### 4. **SupabaseæœåŠ¡ç«¯é—®é¢˜**
- é¡¹ç›®æš‚åœæˆ–è¿‡æœŸ
- APIé™é¢è¶…å‡º
- æœåŠ¡æš‚æ—¶ä¸å¯ç”¨

## ğŸ“Š è¯Šæ–­æ­¥éª¤

### æ­¥éª¤1ï¼šéªŒè¯ç¯å¢ƒå˜é‡åŠ è½½

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
console.log('Supabase URL:', import.meta.env.VITE_SUPABASE_URL);
console.log('Supabase Key:', import.meta.env.VITE_SUPABASE_ANON_KEY?.substring(0, 20) + '...');
```

**é¢„æœŸè¾“å‡º**ï¼š
- Supabase URL: https://assfhuxuglbootvpigeu.supabase.co
- Supabase Key: eyJhbGciOiJIUzI1NiIs...

**å¦‚æœè¾“å‡ºä¸º undefined**ï¼š
- ç¯å¢ƒå˜é‡æœªåŠ è½½
- éœ€è¦é‡å¯Viteå¼€å‘æœåŠ¡å™¨

### æ­¥éª¤2ï¼šæ£€æŸ¥.envæ–‡ä»¶æ ¼å¼

**å½“å‰.envå†…å®¹**ï¼š
```env
VITE_SUPABASE_URL=https://assfhuxuglbootvpigeu.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzc2ZodXh1Z2xib290dnBpZ2V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzOTIzNjUsImV4cCI6MjA4MTk2ODM2NX0.bTWc11pGIvy9Fz5O_9Gch3ZJEVP2pdKlTT5N79gcWCA
```

**é—®é¢˜å‘ç°**ï¼š
- API Keyè¡Œæœ«å°¾å¯èƒ½ç¼ºå°‘æ¢è¡Œç¬¦
- æŸäº›ç¼–è¾‘å™¨å¯èƒ½ä¿å­˜ä¸ºä¸æ­£ç¡®çš„æ ¼å¼

**æ­£ç¡®æ ¼å¼**ï¼š
```env
VITE_SUPABASE_URL=https://assfhuxuglbootvpigeu.supabase.co

VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzc2ZodXh1Z2xib290dnBpZ2V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzOTIzNjUsImV4cCI6MjA4MTk2ODM2NX0.bTWc11pGIvy9Fz5O_9Gch3ZJEVP2pdKlTT5N79gcWCA
```

æ³¨æ„ï¼šç¡®ä¿æ¯è¡Œä»¥æ¢è¡Œç¬¦ç»“æŸï¼Œæœ€åä¹Ÿæœ‰æ¢è¡Œç¬¦

### æ­¥éª¤3ï¼šæµ‹è¯•Supabaseè¿æ¥

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
// æµ‹è¯•Supabaseå®¢æˆ·ç«¯åˆå§‹åŒ–
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

const url = 'https://assfhuxuglbootvpigeu.supabase.co';
const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzc2ZodXh1Z2xib290dnBpZ2V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzOTIzNjUsImV4cCI6MjA4MTk2ODM2NX0.bTWc11pGIvy9Fz5O_9Gch3ZJEVP2pdKlTT5N79gcWCA';

const supabase = createClient(url, key);

// æµ‹è¯•æŸ¥è¯¢
supabase
  .from('profile')
  .select('*')
  .single()
  .then(({ data, error }) => {
    console.log('Data:', data);
    console.log('Error:', error);
  });
```

**å¯èƒ½çš„é”™è¯¯**ï¼š
- `Invalid API key` â†’ Keyå·²è¿‡æœŸæˆ–é”™è¯¯
- `Table not found` â†’ æ•°æ®åº“è¡¨ä¸å­˜åœ¨
- `Permission denied` â†’ RLSç­–ç•¥é˜»æ­¢è®¿é—®
- `Network error` â†’ è¿æ¥é—®é¢˜

### æ­¥éª¤4ï¼šæ£€æŸ¥æµè§ˆå™¨ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾å¤±è´¥çš„è¯·æ±‚ï¼š
   - çº¢è‰²çŠ¶æ€ï¼ˆ400ã€401ã€403ã€404ã€500ç­‰ï¼‰
   - ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼š
     - Request URL
     - Request Headers
     - Response
     - Response Headers

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®å¤ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

1. **é‡æ–°åˆ›å»º.envæ–‡ä»¶**ï¼š
```bash
cd frontend
# åˆ é™¤æ—§æ–‡ä»¶
rm .env
# åˆ›å»ºæ–°æ–‡ä»¶
cat > .env << 'EOF'
VITE_SUPABASE_URL=https://assfhuxuglbootvpigeu.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzc2ZodXh1Z2xib290dnBpZ2V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzOTIzNjUsImV4cCI6MjA4MTk2ODM2NX0.bTWc11pGIvy9Fz5O_9Gch3ZJEVP2pdKlTT5N79gcWCA
EOF
```

2. **é‡å¯Viteå¼€å‘æœåŠ¡å™¨**ï¼š
```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
npm run dev
```

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨åç«¯APIï¼ˆæ¶æ„æ”¹è¿›ï¼‰

**å½“å‰é—®é¢˜**ï¼šå‰ç«¯ç›´æ¥è¿æ¥Supabaseï¼Œç»•è¿‡äº†åç«¯

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
1. å‰ç«¯é€šè¿‡åç«¯APIè·å–æ•°æ®
2. åç«¯è¿æ¥Supabase
3. æ›´å¥½çš„æ§åˆ¶å’Œå®‰å…¨æ€§

#### å®æ–½æ­¥éª¤

1. **åˆ›å»ºAPIæœåŠ¡æ–‡ä»¶** `frontend/src/services/api.ts`ï¼š
```typescript
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';

export const api = {
  profile: {
    get: async () => {
      const response = await fetch(`${API_BASE_URL}/profile`);
      if (!response.ok) throw new Error('Failed to fetch profile');
      return response.json();
    }
  },
  
  blogs: {
    list: async (page = 0, limit = 10) => {
      const response = await fetch(`${API_BASE_URL}/blogs?page=${page}&limit=${limit}`);
      if (!response.ok) throw new Error('Failed to fetch blogs');
      return response.json();
    },
    
    get: async (id: string) => {
      const response = await fetch(`${API_BASE_URL}/blogs/${id}`);
      if (!response.ok) throw new Error('Failed to fetch blog');
      return response.json();
    }
  },
  
  qa: {
    list: async (page = 0, limit = 10) => {
      const response = await fetch(`${API_BASE_URL}/qa?page=${page}&limit=${limit}`);
      if (!response.ok) throw new Error('Failed to fetch questions');
      return response.json();
    }
  }
};
```

2. **æ›´æ–°.envæ–‡ä»¶**ï¼š
```env
VITE_API_URL=http://localhost:3001/api
```

3. **ä¿®æ”¹About.tsxä½¿ç”¨æ–°API**ï¼š
```typescript
import { api } from '../services/api';

// åœ¨useEffectä¸­
const data = await api.profile.get();
setProfile(data);
```

### æ–¹æ¡ˆ3ï¼šå®Œå…¨æœ¬åœ°åŒ–ï¼ˆå¼€å‘é˜¶æ®µï¼‰

**ä¼˜ç‚¹**ï¼š
- ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
- å¼€å‘é€Ÿåº¦å¿«
- å®Œå…¨å¯æ§

**ç¼ºç‚¹**ï¼š
- éœ€è¦æ‰‹åŠ¨ç®¡ç†æ•°æ®
- æ— æ³•å±•ç¤ºçœŸå®APIé›†æˆ

#### å®æ–½æ–¹å¼

åˆ›å»º `frontend/src/data/mockData.ts`ï¼š
```typescript
export const mockProfile = {
  id: 1,
  name: 'å°¹åšä¸€',
  age: 19,
  location: 'æ­¦æ±‰',
  qq: '123456789',
  email: 'example@email.com',
  bio: 'æ­¦æ±‰ç†å·¥å¤§å­¦ç»æµå­¦é™¢åœ¨è¯»æœ¬ç§‘ç”Ÿï¼Œçƒ­çˆ±å­¦ä¹ ï¼Œç§¯æè¿›å–',
  education: 'æ­¦æ±‰ç†å·¥å¤§å­¦',
  major: 'ç»æµå­¦',
  interests: ['æ¸¸æˆ', 'è¿åŠ¨', 'é˜…è¯»'],
  motto: 'æ°¸ä¸æ”¾å¼ƒï¼ŒæŒç»­è¿›æ­¥',
  created_at: new Date().toISOString()
};
```

åœ¨æ‰€æœ‰é¡µé¢ä½¿ç”¨mockæ•°æ®ã€‚

### æ–¹æ¡ˆ4ï¼šä½¿ç”¨Vite Proxyï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

**ç›®çš„**ï¼šè§£å†³CORSé—®é¢˜ï¼Œç»Ÿä¸€APIè¯·æ±‚

#### é…ç½®vite.config.ts
```typescript
export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    allowedHosts: true,
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        rewrite: (path) => path
      },
      '/supabase': {
        target: 'https://assfhuxuglbootvpigeu.supabase.co',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/supabase/, ''),
        configure: (proxy, options) => {
          proxy.on('proxyReq', (proxyReq) => {
            proxyReq.setHeader('apikey', import.meta.env.VITE_SUPABASE_ANON_KEY);
            proxyReq.setHeader('Authorization', `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`);
          });
        }
      }
    }
  },
  // ... å…¶ä»–é…ç½®
});
```

#### æ›´æ–°å‰ç«¯é…ç½®
```typescript
// frontend/src/config/supabase.ts
const supabaseUrl = '/supabase';
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
```

## ğŸ¯ æ¨èè§£å†³æ–¹æ¡ˆä¼˜å…ˆçº§

### å¼€å‘é˜¶æ®µï¼š
1. **æ–¹æ¡ˆ1**ï¼šä¿®å¤ç¯å¢ƒå˜é‡ï¼ˆæœ€ç®€å•ï¼‰
2. **æ–¹æ¡ˆ3**ï¼šä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®ï¼ˆæœ€ç¨³å®šï¼‰
3. **æ–¹æ¡ˆ4**ï¼šVite Proxyï¼ˆè§£å†³CORSï¼‰

### ç”Ÿäº§ç¯å¢ƒï¼š
1. **æ–¹æ¡ˆ2**ï¼šä½¿ç”¨åç«¯APIï¼ˆæœ€ä½³æ¶æ„ï¼‰
2. æ›´æ–°åç«¯.envæ–‡ä»¶é…ç½®æ­£ç¡®çš„Supabaseå‡­è¯

## âš¡ å¿«é€Ÿä¿®å¤ï¼ˆç«‹å³å¯ç”¨ï¼‰

ä¿®æ”¹ `frontend/src/config/supabase.ts`ï¼š
```typescript
import { createClient, SupabaseClient } from '@supabase/supabase-js';

// ç¡¬ç¼–ç é…ç½®ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼Œç¡®è®¤å·¥ä½œåæ”¹å›ç¯å¢ƒå˜é‡ï¼‰
const supabaseUrl = 'https://assfhuxuglbootvpigeu.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzc2ZodXh1Z2xib290dnBpZ2V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzOTIzNjUsImV4cCI6MjA4MTk2ODM2NX0.bTWc11pGIvy9Fz5O_9Gch3ZJEVP2pdKlTT5N79gcWCA';

export const supabase: SupabaseClient = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
  },
});

export default supabase;
```

è¿™æ ·å¯ä»¥ç›´æ¥æ’é™¤ç¯å¢ƒå˜é‡é—®é¢˜ã€‚

## ğŸ“ éªŒè¯æ¸…å•

- [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯
- [ ] éªŒè¯Supabase URLå’ŒKeyæ ¼å¼
- [ ] æµ‹è¯•Supabaseè¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦å­˜åœ¨
- [ ] éªŒè¯RLSç­–ç•¥
- [ ] é‡å¯Viteå¼€å‘æœåŠ¡å™¨
- [ ] æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- [ ] ä½¿ç”¨éšèº«æ¨¡å¼æµ‹è¯•

## ğŸ†˜ å¦‚æœæ‰€æœ‰æ–¹æ¡ˆéƒ½å¤±è´¥

1. **è”ç³»Supabaseæ”¯æŒ**ï¼šæ£€æŸ¥é¡¹ç›®çŠ¶æ€å’ŒAPI Key
2. **åˆ›å»ºæ–°çš„Supabaseé¡¹ç›®**ï¼šé‡æ–°å¼€å§‹
3. **å®Œå…¨æœ¬åœ°åŒ–**ï¼šå…ˆå¼€å‘åŠŸèƒ½ï¼Œåé›†æˆæœåŠ¡
4. **æ£€æŸ¥é˜²ç«å¢™/ä»£ç†**ï¼šç½‘ç»œç¯å¢ƒå¯èƒ½é˜»æ­¢è¯·æ±‚

---

**å»ºè®®**ï¼šå…ˆå°è¯•"å¿«é€Ÿä¿®å¤"æ–¹æ¡ˆï¼Œç¡¬ç¼–ç é…ç½®éªŒè¯è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç„¶åå†é€æ­¥æ’æŸ¥ç¯å¢ƒå˜é‡é—®é¢˜ã€‚
